<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>DF CANARY BIRD AI</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#202c33">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #0b141a; color: #e9edef; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; margin: 0; }
        
        /* Header WhatsApp Modern */
        .chat-header { background: #202c33; padding: 10px 16px; display: flex; align-items: center; border-bottom: 1px solid #313d45; position: relative; z-index: 10; }
        
        /* Profil Bulat Sempurna [cite: 2026-01-22] */
        .profile-pic { 
            width: 50px; height: 50px; border-radius: 50%; margin-right: 12px; 
            overflow: hidden; background: #313d45; display: flex; 
            align-items: center; justify-content: center; flex-shrink: 0; 
        }
        .profile-pic img { width: 100%; height: 100%; object-fit: cover; }

        .header-info { flex: 1; }
        .header-info h1 { font-size: 16px; margin: 0; color: #e9edef; font-weight: 500; }
        .header-info .phone-num { font-size: 11px; color: #8696a0; display: block; margin-top: -2px; }
        
        /* Efek Online Glow [cite: 2026-01-22] */
        .status-online { font-size: 12px; color: #00a884; display: flex; align-items: center; gap: 4px; margin-top: 2px; }
        .dot { width: 8px; height: 8px; background-color: #00a884; border-radius: 50%; display: inline-block; box-shadow: 0 0 8px #00a884; animation: pulse 1.5s infinite; }
        
        @keyframes pulse {
            0% { opacity: 1; box-shadow: 0 0 0px #00a884; }
            50% { opacity: 0.5; box-shadow: 0 0 10px #00a884; }
            100% { opacity: 1; box-shadow: 0 0 0px #00a884; }
        }

        .btn-clear { position: absolute; right: 15px; top: 15px; color: #8696a0; font-size: 20px; cursor: pointer; }

        /* Chat Wallpaper */
        #chatBox { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 8px; background-color: #0b141a; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-blend-mode: overlay; }
        
        .msg { max-width: 80%; padding: 8px 12px; font-size: 14.5px; border-radius: 8px; line-height: 1.4; box-shadow: 0 1px 1px rgba(0,0,0,0.2); }
        .user { background: #005c4b; align-self: flex-end; border-top-right-radius: 0; }
        .bot { background: #202c33; align-self: flex-start; border-top-left-radius: 0; }
        .img-preview-msg { max-width: 100%; border-radius: 8px; margin-bottom: 5px; display: block; }

        .input-area { background: #202c33; padding: 10px; display: flex; align-items: center; gap: 8px; }
        .input-wrapper { flex: 1; background: #2a3942; border-radius: 24px; padding: 5px 15px; display: flex; align-items: center; gap: 12px; }
        input { flex: 1; background: transparent; border: none; color: #d1d7db; outline: none; padding: 8px; font-size: 15px; }
        
        .btn-plus { color: #8696a0; font-size: 24px; cursor: pointer; }
        .btn-send { background: #00a884; border: none; width: 45px; height: 45px; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        
        .typing { font-size: 12px; color: #8696a0; padding: 5px 25px; display: none; font-style: italic; }
        #imageInput { display: none; }
    </style>
</head>
<body>

<div class="chat-header">
    <div class="profile-pic">
        <img src="https://i.postimg.cc/FsW8CpVv/20251121-082716.png" alt="Logo">
    </div>
    <div class="header-info">
        <h1>DF CANARY BIRD</h1>
        <span class="phone-num">082213054013</span>
        <div class="status-online"><span class="dot"></span> Online</div>
    </div>
    <div class="btn-clear" onclick="clearChat()">⋮</div>
</div>

<div id="chatBox"></div>
<div id="typingIndicator" class="typing">leakejora sedang menjawab...</div>

<div class="input-area">
    <div class="input-wrapper">
        <label for="imageInput" class="btn-plus">+</label>
        <input type="file" id="imageInput" accept="image/*" onchange="handleImageSelect()">
        <input type="text" id="userInput" placeholder="Ketik pesan" onkeypress="if(event.key==='Enter') sendMessage()">
    </div>
    <button class="btn-send" onclick="sendMessage()">➔</button>
</div>

<script>
    /* KONFIGURASI API GEMINI 2.5 FLASH & DATA PERMANEN [cite: 2026-01-22] */
    const API_KEY = "AIzaSyDx_4bA1AyHSbKq-bvL7U0pknEOalH3OWw";
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;
    let base64Image = null;

    // Load riwayat secara otomatis saat buka aplikasi [cite: 2026-01-22]
    window.onload = () => {
        const history = JSON.parse(localStorage.getItem('canary_pro_chat')) || [];
        history.forEach(m => appendMessage(m.role, m.text, m.img));
    };

    function handleImageSelect() {
        const file = document.getElementById('imageInput').files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            base64Image = e.target.result.split(',')[1];
            alert("Gambar burung kenari siap dikirim!");
        };
        reader.readAsDataURL(file);
    }

    async function sendMessage() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        if (!text && !base64Image) return;

        const imgForDisplay = base64Image ? `data:image/jpeg;base64,${base64Image}` : null;
        appendMessage('user', text, imgForDisplay);
        saveChat('user', text, imgForDisplay);
        
        input.value = '';
        document.getElementById('typingIndicator').style.display = 'block';

        const parts = [{ text: "Jawablah sebagai ahli ternak kenari DF CANARY. Pertanyaan: " + (text || "Tolong analisa foto burung ini.") }];
        if (base64Image) {
            parts.push({ inline_data: { mime_type: "image/jpeg", data: base64Image } });
        }

        try {
            const res = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: parts }] })
            });

            if (!res.ok) throw new Error("API Limit");

            const data = await res.json();
            const reply = data.candidates[0].content.parts[0].text;
            appendMessage('bot', reply);
            saveChat('bot', reply, null);
        } catch (e) {
            appendMessage('bot', "Maaf, koneksi terputus. Silakan coba lagi.");
        } finally {
            base64Image = null;
            document.getElementById('imageInput').value = "";
            document.getElementById('typingIndicator').style.display = 'none';
        }
    }

    function appendMessage(role, text, img) {
        const box = document.getElementById('chatBox');
        const div = document.createElement('div');
        div.className = `msg ${role}`;
        if (img) div.innerHTML += `<img src="${img}" class="img-preview-msg">`;
        if (text) div.innerHTML += `<div>${text}</div>`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    function saveChat(role, text, img) {
        let history = JSON.parse(localStorage.getItem('canary_pro_chat')) || [];
        history.push({ role, text, img });
        localStorage.setItem('canary_pro_chat', JSON.stringify(history));
    }

    function clearChat() {
        if(confirm("Hapus semua percakapan permanen?")) {
            localStorage.removeItem('canary_pro_chat');
            location.reload();
        }
    }
</script>
</body>
</html>
